<ng-template #rt let-r="result" let-t="term">
  {{ r.nome }}
</ng-template>

<div class="col-12" style="padding: 15px; margin: 0px">
  <app-page-header
    [pheading]="' Movimentos'"
    [picon]="'fa-retweet'"
    [heading]="'Movimento'"
    [icon]="'fa-th-list'"
  >
  </app-page-header>

  <div class="card div-geral-page">
    <ngx-spinner
      [fullScreen]="false"
      bdColor="rgba(51,51,51,0.8)"
      size="medium"
      color="#fff"
      type="ball-spin-clockwise"
    >
      <p style="font-size: 20px; color: white">
        Comunicando com o Servidor, Aguarde...
      </p>
    </ngx-spinner>

    <div *ngIf="statusForm === 1 || statusForm === 2" class="row">
      <div class="col-md-12">
        <div class="card bg-light mb-3">
          <div class="card-body">
            <div class="row">
              <div
                class="col-lg-3 col-xl-3 col-6 d-grid"
                [ngbTooltip]="tooltipBtnSalvar()"
              >
                <button
                  class="btn btn-block butao-acao"
                  [ngClass]="statusForm === 2 ? 'btn-warning' : 'btn-primary'"
                  [disabled]="isDisableSalvaAtualiza()"
                  (click)="onCadastra()"
                >
                  <span class="fa fa-save span-acao"></span>
                  {{ statusForm === 2 ? "Alterar" : "Salvar" }}
                </button>
              </div>
              <div
                class="col-lg-2 col-xl-2 col-6 d-grid"
                ngbTooltip="Botão de limpar todos os campos"
              >
                <button
                  type="button"
                  class="btn btn-block btn-outline-dark butao-acao"
                  (click)="onLimpa()"
                >
                  <span class="fa fa-eraser span-acao"></span> Limpar
                </button>
              </div>
              <div
                class="col-lg-1 col-xl-1 col-4 d-grid"
                ngbTooltip="Botão de movimentar a pesquisa para esquerda"
              >
                <button
                  type="button"
                  class="btn btn-block btn-info butao-acao"
                  (click)="onLeftArray()"
                >
                  <span class="fa fa-arrow-circle-left span-acao"></span>
                </button>
              </div>
              <div
                class="col-lg-1 col-xl-1 col-4 d-grid"
                ngbTooltip="Botão de movimentar a pesquisa para direita"
              >
                <button
                  type="button"
                  class="btn btn-block btn-info butao-acao"
                  (click)="onRightArray()"
                >
                  <span class="fa fa-arrow-circle-right span-acao"></span>
                </button>
              </div>
              <div
                class="col-lg-1 col-xl-1 col-4 d-grid"
                ngbTooltip="Botão de alternar para visão de tabela de pesquisa"
              >
                <button
                  type="button"
                  class="btn btn-block btn-info butao-acao"
                  (click)="onTable()"
                >
                  <span class="fa fa-table span-acao"></span>
                </button>
              </div>
              <div
                class="col-lg-2 col-xl-2 col-6 d-grid"
                [ngbTooltip]="tooltipBtnDeletar()"
              >
                <button
                  type="button"
                  [disabled]="!isValidDelete()"
                  class="btn btn-block btn-danger butao-acao"
                  (click)="onDeleta(movimento.id)"
                >
                  <span class="fa fa-trash span-acao"></span> Deletar
                </button>
              </div>
              <div
                class="col-lg-2 col-xl-2 col-6 d-grid"
                ngbTooltip="Botão de pesquisar movimentos salvos"
              >
                <button
                  type="button"
                  class="btn btn-block btn-success butao-acao"
                  (click)="onPesquisa()"
                >
                  <span class="fa fa-search span-acao"></span> Pesq
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card bg-light mb-3">
          <div class="card-body">
            <div class="row">
              <div class="col-lg-2 col-xl-2 col-sm-2 col-12 d-grid">
                <button
                  type="button"
                  class="btn btn-outline-dark"
                  (click)="findMovimentoItens()"
                >
                  <span class="fa fa-search span-acao"></span>Busca movimento
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card bg-light mb-3">
          <div class="card-header">Movimentos</div>
          <div class="card-body">
            <form [formGroup]="movForm">

              <div ngbAccordion>
                <div ngbAccordionItem [collapsed]="true">
                    <h2 ngbAccordionHeader>
                        <button ngbAccordionButton>CAMPOS DE PESQUISA ADICIONAIS</button>
                    </h2>

                    <div ngbAccordionCollapse>
                        <div ngbAccordionBody>
                          <ng-template ngbPanelContent>
                            <div class="row">
                              <div class="col-sm-6 col-6 padding-5">
                                <div class="form-group">
                                  <label for="idInputDtaInclusaoInicial"
                                    >Data Inclusão Inicial</label
                                  >
                                  <input
                                    type="date"
                                    class="form-control"
                                    id="idInputDtaInclusaoInicial"
                                    name="nmInputDtaInclusaoInicial"
                                    ngbTooltip="Busca de pela data de inclusão, data inicial"
                                    [(ngModel)]="
                                      movimentoPesquisaDTO.dtaInicialPesquisa
                                    "
                                    [ngModelOptions]="{ standalone: true }"
                                  />
                                </div>
                              </div>
        
                              <div class="col-sm-6 col-6 padding-5">
                                <div class="form-group">
                                  <label for="idInputDtaInclusaoFinal"
                                    >Data Inclusão Final</label
                                  >
                                  <input
                                    type="date"
                                    class="form-control"
                                    id="idInputDtaInclusaoFinal"
                                    name="nmInputDtaInclusaoFinal"
                                    ngbTooltip="Busca de pela data de inclusão, data final"
                                    [(ngModel)]="movimentoPesquisaDTO.dtaFinalPesquisa"
                                    [ngModelOptions]="{ standalone: true }"
                                  />
                                </div>
                              </div>
                            </div>
                          </ng-template>
                        </div>
                    </div>
                </div>
            </div>




              <br />

              <div class="form-group row" *ngIf="statusForm === 2">
                <div class="col-sm-2">
                  <button
                    type="button"
                    class="btn btn-outline-dark"
                    (click)="openPrintPage()"
                  >
                    <span class="fa fa-print span-acao"></span>
                  </button>
                </div>
              </div>

              <div class="row">
                <div class="col-sm-2 col-12 div-line">
                  <div class="form-group">
                    <label for="inputId">Id Movimento</label>
                    <input
                      type="number"
                      class="form-control"
                      formControlName="id"
                      id="inputId"
                      #movId
                      (keydown.enter)="onPesquisa($event)"
                      ngbTooltip="Id Movimento"
                    />
                  </div>
                </div>

                <div class="col-sm-5 col-12 div-line">
                  <div class="form-group">
                    <label for="idUsuarioInclusao">Usuário Inclusão</label>
                    <input
                      type="text"
                      class="form-control"
                      id="idUsuarioInclusao"
                      formControlName="usuarioInclusao"
                      ngbTooltip="Usuário Inclusão"
                    />
                  </div>
                </div>

                <div class="col-sm-5 col-12 div-line">
                  <div class="form-group">
                    <label for="idDtaInclusao">Data Inclusão</label>
                    <input
                      type="text"
                      id="idDtaInclusao"
                      class="form-control"
                      ngbTooltip="Data Inclusão"
                      [value]="
                        movimento.dtaInclusao
                          | amDateFormat : 'DD/MM/YYYY HH:mm:ss'
                      "
                      disabled
                    />
                  </div>
                </div>

                <br />

                <div class="col-12 div-line">
                  <div class="form-group">
                    <label for="idOrigemMov">Origem</label>
                    <select
                      class="form-control"
                      name="nameOrigemMov"
                      id="idOrigemMov"
                      [compareWith]="compareMovimentoOrigem"
                      formControlName="movimentoOrigemDTO"
                      [ngClass]="{
                        'is-invalid': submitted && f.movimentoOrigemDTO.errors
                      }"
                    >
                      <option [ngValue]="null">Selecione</option>
                      <option
                        *ngFor="let mos of movimentoOrigens"
                        [ngValue]="mos"
                      >
                        {{ mos.nome }}
                      </option>
                    </select>

                    <div
                      *ngIf="submitted && f.movimentoOrigemDTO.errors"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.movimentoOrigemDTO.errors['required']">
                        Selecione uma Origem
                      </div>
                    </div>
                  </div>
                </div>

                <br />

                <div class="col-12 div-line">
                  <div class="form-group">
                    <label for="idAmoxarifado">Almoxarifado</label>

                    <select
                      class="form-control"
                      id="idAmoxarifado"
                      [ngClass]="{
                        'is-invalid':
                          submitted && f.estoqueAlmoxarifadoDTO.errors
                      }"
                      [compareWith]="compareAlmoxarifado"
                      formControlName="estoqueAlmoxarifadoDTO"
                    >
                      <option [ngValue]="null">Selecione</option>
                      <option *ngFor="let al of almoxarifados" [ngValue]="al">
                        {{ al.nome }}
                      </option>
                    </select>

                    <div
                      *ngIf="submitted && f.estoqueAlmoxarifadoDTO.errors"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.estoqueAlmoxarifadoDTO.errors['required']">
                        Selecione um Almoxarifado
                      </div>
                    </div>
                  </div>
                </div>

                <br />

                <div class="col-12 div-line">
                  <div class="form-group">
                    <label for="idTipo">Tipo</label>

                    <select
                      class="form-control"
                      id="idTipo"
                      formControlName="movimentoTipoDTO"
                      [ngClass]="{
                        'is-invalid': submitted && f.movimentoTipoDTO.errors
                      }"
                      [compareWith]="compareMovimentoTipo"
                    >
                      <option [ngValue]="null">Selecione</option>
                      <option
                        *ngFor="let mov of movimentoTipos"
                        [ngValue]="mov"
                      >
                        {{ mov.nome }}
                      </option>
                    </select>

                    <div
                      *ngIf="submitted && f.movimentoTipoDTO.errors"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.movimentoTipoDTO.errors['required']">
                        Selecione um Tipo
                      </div>
                    </div>
                  </div>
                </div>

                <br />

                <div class="col-12 div-line">
                  <div class="form-group">
                    <label for="idVeiculo">Veiculo</label>

                    <select
                      class="form-control"
                      id="idVeiculo"
                      formControlName="veiculoDTO"
                      [ngClass]="{
                        'is-invalid': submitted && f.veiculoDTO.errors
                      }"
                      [compareWith]="compareVeiculo"
                    >
                      <option [ngValue]="null">Selecione</option>
                      <option *ngFor="let v of veiculos" [ngValue]="v">
                        NOME: {{ v.nome }} | PLACA:
                        {{ v.placa }}
                      </option>
                    </select>

                    <div
                      *ngIf="submitted && f.veiculoDTO.errors"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.veiculoDTO.errors['required']">
                        Selecione um Veiculo
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-sm-2 col-12 div-line">
                  <div class="form-group">
                    <label for="idClienteId">Cli ID</label>
                    <div class="input-group">
                      <input
                        class="form-control"
                        id="idClienteId"
                        type="number"
                        #clienteId
                        formControlName="clienteId"
                        ngbTooltip="Precione Tab ou enter para pesquisar por ID de cliente"
                        (keydown.Tab)="selectClienteByCod($event)"
                        (keydown.enter)="selectClienteByCod($event)"
                      />
                      <div class="input-group-append">
                        <button
                          class="btn btn-secondary"
                          (click)="selectClienteByCod($event)"
                          type="button"
                        >
                          <i class="fa fa-search"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-sm-10 col-12 div-line">
                  <div class="form-group">
                    <label for="idTypeaheadCliente">Cliente Nome</label>
                    <input
                      id="idTypeaheadCliente"
                      type="text"
                      class="form-control"
                      [class.is-invalid]="searchFailedCliente"
                      (selectItem)="typeaHeadSelectCliente($event)"
                      formControlName="clienteDTO"
                      [ngbTypeahead]="searchCliente"
                      [resultTemplate]="rt"
                      [inputFormatter]="inputFormatterCliente"
                      placeholder="Busca de Cliente"
                    />
                    <span
                      class="col-sm-2 col-form-label"
                      *ngIf="searchingCliente"
                      >procurando...</span
                    >
                    <span
                      class="col-sm-12 col-form-label"
                      *ngIf="searchFailedCliente"
                      >Não foi encontrado nada</span
                    >
                  </div>
                </div>

                <div *ngIf="isCliente()" class="col-sm-12">
                  <div class="col-sm-12 div-info">
                    <span>Cliente Configurado</span>
                  </div>
                  <table class="table table-bordered table-object-selected">
                    <thead>
                      <tr>
                        <th>Id</th>
                        <th>Nome</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="align-left">{{ f.clienteDTO.value!.id }}</td>
                        <td class="align-left">
                          {{ f.clienteDTO.value!.nome }}
                        </td>
                        <td class="align-center">
                          <button
                            class="btn btn-danger"
                            (click)="resetaCliente()"
                            (keydown.enter)="resetaCliente()"
                            tabindex="100"
                          >
                            <fa-icon
                              class="ms-auto"
                              [icon]="['fas', 'trash']"
                            ></fa-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="col-sm-2 col-12 div-line">
                  <div class="form-group">
                    <label for="idFornecedorId">For ID</label>
                    <div class="input-group">
                      <input
                        class="form-control"
                        id="idFornecedorId"
                        type="number"
                        #fornecedorId
                        ngbTooltip="Precione Tab ou enter para pesquisar por ID de fornecedor"
                        formControlName="fornecedorId"
                        (keydown.Tab)="selectFornecedorByCod($event)"
                        (keydown.enter)="selectFornecedorByCod($event)"
                      />
                      <div class="input-group-append">
                        <button
                          class="btn btn-secondary"
                          (click)="selectFornecedorByCod($event)"
                          type="button"
                        >
                          <i class="fa fa-search"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-sm-10 col-12 div-line">
                  <div class="form-group">
                    <label for="idTypeaheadFornecedor">Fornecedor Nome</label>
                    <input
                      id="idTypeaheadFornecedor"
                      formControlName="fornecedorDTO"
                      type="text"
                      class="form-control"
                      [class.is-invalid]="searchFailedFornecedor"
                      (selectItem)="selectedFornecedor($event)"
                      [ngbTypeahead]="searchFornecedor"
                      [resultTemplate]="rt"
                      [inputFormatter]="inputFormatterFornecedor"
                      placeholder="Busca de Fornecedor"
                    />

                    <span
                      class="col-sm-2 col-form-label"
                      *ngIf="searchingFornecedor"
                      >procurando...</span
                    >
                    <span
                      class="col-sm-12 col-form-label"
                      *ngIf="searchFailedFornecedor"
                      >Não foi encontrado nada
                    </span>
                  </div>
                </div>

                <div *ngIf="isFornecedor()" class="col-sm-12">
                  <div class="col-sm-12 div-info">
                    <span>Fornecedor Configurado</span>
                  </div>

                  <table class="table table-bordered table-object-selected">
                    <thead>
                      <tr>
                        <th>Id</th>
                        <th>Nome</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="align-left">
                          {{ f.fornecedorDTO.value!.id }}
                        </td>
                        <td class="align-left">
                          {{ f.fornecedorDTO.value!.nome }}
                        </td>
                        <td class="align-center">
                          <button
                            class="btn btn-danger"
                            (click)="resetaFornecedor()"
                            (keydown.enter)="resetaFornecedor()"
                            tabindex="101"
                          >
                            <fa-icon
                              class="ms-auto"
                              [icon]="['fas', 'trash']"
                            ></fa-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <br />

                <div class="col-12 div-line">
                  <div class="form-group">
                    <label for="idMotorista">Motorista</label>

                    <select
                      class="form-control"
                      id="idMotorista"
                      formControlName="motoristaDTO"
                      [ngClass]="{
                        'is-invalid': submitted && f.motoristaDTO.errors
                      }"
                      [compareWith]="compareFuncionario"
                    >
                      <option [ngValue]="null">Selecione</option>
                      <option *ngFor="let m of motoristas" [ngValue]="m">
                        {{ m.nome }}
                      </option>
                    </select>

                    <div
                      *ngIf="submitted && f.motoristaDTO.errors"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.motoristaDTO.errors['required']">
                        Selecione um Motorista
                      </div>
                    </div>
                  </div>
                </div>

                <br />

                <div class="col-12 div-line">
                  <div class="form-group">
                    <label for="idConferente">Conferente</label>

                    <select
                      class="form-control"
                      id="idConferente"
                      formControlName="conferenteDTO"
                      [ngClass]="{
                        'is-invalid': submitted && f.conferenteDTO.errors
                      }"
                      [compareWith]="compareFuncionario"
                    >
                      <option [ngValue]="null">Selecione</option>
                      <option *ngFor="let c of conferentes" [ngValue]="c">
                        {{ c.nome }}
                      </option>
                    </select>

                    <div
                      *ngIf="submitted && f.conferenteDTO.errors"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.conferenteDTO.errors['required']">
                        Selecione um Conferente
                      </div>
                    </div>
                  </div>
                </div>

                <br />

                <div class="col-sm-8 col-12 div-line">
                  <div class="form-group">
                    <label for="idNumNotaNF">Num Nota NF</label>
                    <input
                      type="text"
                      class="form-control"
                      id="idNumNotaNF"
                      formControlName="numNotaFiscal"
                      ngbTooltip="Num Nota NF"
                    />
                  </div>
                </div>

                <div class="col-sm-2 col-12 div-line">
                  <div class="form-group">
                    <label for="idPreVendaID">Pre Venda ID</label>
                    <input
                      type="number"
                      class="form-control"
                      id="idPreVendaID"
                      formControlName="preVendaId"
                      ngbTooltip="Pre Venda ID"
                    />
                  </div>
                </div>

                <div class="col-sm-2 col-12 div-line">
                  <div class="form-group">
                    <label for="idRomaneio">Romaneio ID</label>
                    <input
                      type="number"
                      class="form-control"
                      id="idRomaneio"
                      formControlName="rotaId"
                      ngbTooltip="Romaneio ID"
                    />
                  </div>
                </div>

                <div class="col-sm-12 col-12 div-line">
                  <div class="form-group">
                    <label for="IdOptIndAtivo">Status</label>

                    <fieldset class="form-group">
                      <label class="radio-inline rinline">
                        <input
                          type="radio"
                          formControlName="indAtivo"
                          id="IdOptIndAtivo"
                          [value]="true"
                        />Ativo
                      </label>
                      <label class="radio-inline rinline">
                        <input
                          type="radio"
                          formControlName="indAtivo"
                          id="IdOptIndAtivo"
                          [value]="false"
                        />Desativado
                      </label>
                    </fieldset>
                  </div>
                </div>

                <div class="col-sm-12 col-12 div-line">
                  <div class="form-group">
                    <label for="IdOptIndAditoria">Auditoria</label>

                    <fieldset class="form-group">
                      <label class="radio-inline rinline">
                        <input
                          type="radio"
                          formControlName="indAuditoria"
                          id="IdOptIndAditoria"
                          [value]="true"
                        />Sim
                      </label>
                      <label class="radio-inline rinline">
                        <input
                          type="radio"
                          formControlName="indAuditoria"
                          id="IdOptIndAditoria"
                          [value]="false"
                        />Não
                      </label>
                    </fieldset>
                  </div>
                </div>

                <div class="col-12 div-line">
                  <div class="form-group">
                    <label for="idDescricao">Descrição</label>
                    <textarea
                      class="form-control"
                      formControlName="descricao"
                      [ngClass]="{
                        'is-invalid': submitted && f.descricao.errors
                      }"
                      id="idDescricao"
                    ></textarea>
                    <div
                      *ngIf="submitted && f.descricao.errors"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.descricao.errors['maxlength']">
                        Tamanho máximo excedido de 4.000 caracteres
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr />


              <div ngbAccordion>
                <div ngbAccordionItem [collapsed]="false">
                    <h2 ngbAccordionHeader>
                        <button ngbAccordionButton>ITENS</button>
                    </h2>
  
                    <div ngbAccordionCollapse>
                        <div ngbAccordionBody>
                          <ng-template >
                            <div class="row" formGroupName="item">
        
                              <div class="col-sm-2 col-12 div-line">
                                <div class="form-group">
                                  <label for="idItemId">Item ID</label>
                                  <div class="input-group">
                                    <input
                                      class="form-control"
                                      id="idItemId"
                                      type="number"
                                      #itemId
                                      ngbTooltip="Precione Tab ou enter para pesquisar por ID de item"
                                      formControlName="itemId"
                                      (keydown.Tab)="selectedItemId($event)"
                                      (keydown.enter)="selectedItemId($event)"
                                    />
                                    <div class="input-group-append">
                                      <button
                                        class="btn btn-secondary"
                                        (click)="selectedItemId($event)"
                                        type="button"
                                      >
                                        <i class="fa fa-search"></i>
                                      </button>
                                    </div>
                                  </div>
                                </div>
                              </div>
        
                              <div class="col-sm-2 col-12 div-line">
                                <div class="form-group">
                                  <label for="idItemIdAux">Item ID Aux</label>
                                  <div class="input-group">
                                    <input
                                      class="form-control"
                                      id="idItemIdAux"
                                      type="number"
                                      #itemId
                                      ngbTooltip="Precione Tab ou enter para pesquisar por ID Aux do item"
                                      formControlName="itemIdAux"
                                      (keydown.Tab)="selectedItemIdAux($event)"
                                      (keydown.enter)="selectedItemIdAux($event)"
                                    />
                                    <div class="input-group-append">
                                      <button
                                        class="btn btn-secondary"
                                        (click)="selectedItemIdAux($event)"
                                        type="button"
                                      >
                                        <i class="fa fa-search"></i>
                                      </button>
                                    </div>
                                  </div>
                                </div>
                              </div>
        
                              <div class="col-sm-8 col-12 div-line">
                                <div class="form-group">
                                  <label for="idTypeaheadItem">Item Nome</label>
        
                                  <input
                                    id="idTypeaheadItem"
                                    [ngbTypeahead]="searchItem"
                                    #itemNome
                                    [resultTemplate]="rt"
                                    (selectItem)="selectedItem($event)"
                                    [ngClass]="{
                                      'is-invalid':
                                        submittedItem && fi['itemDTO'].errors
                                    }"
                                    type="text"
                                    formControlName="itemDTO"
                                    class="form-control"
                                    [class.is-invalid]="searchFailedItem"
                                    [inputFormatter]="inputFormatterItem"
                                    placeholder="Busca de Item"
                                  />
        
                                  <span
                                    class="col-sm-2 col-form-label"
                                    *ngIf="searchingItem"
                                    >procurando...</span
                                  >
                                  <span
                                    class="col-sm-2 col-form-label"
                                    *ngIf="searchFailedItem"
                                    >Não encontrado</span
                                  >
        
                                  <div
                                    *ngIf="submittedItem && fi['itemDTO'].errors"
                                    class="invalid-feedback"
                                  >
                                    <div *ngIf="fi['itemDTO'].errors['required']">
                                      Selecione um Item
                                    </div>
                                  </div>
                                </div>
                              </div>
        
                              <div class="col-sm-4 col-12 div-line">
                                <div class="form-group">
                                  <label for="idUnidade">Unidade</label>
        
                                  <select
                                    class="form-control"
                                    id="idUnidade"
                                    #itemUnidade
                                    formControlName="itemUnidadeDTO"
                                    [ngClass]="{
                                      'is-invalid':
                                        submittedItem && fi['itemUnidadeDTO'].errors
                                    }"
                                    [compareWith]="compareUnidade"
                                  >
                                    <option [ngValue]="null">Selecione</option>
                                    <option
                                      *ngFor="let un of itemUnidadeDTOs"
                                      [ngValue]="un"
                                    >
                                      {{ un.nome }}
                                    </option>
                                  </select>
        
                                  <div
                                    *ngIf="submittedItem && fi['itemUnidadeDTO'].errors"
                                    class="invalid-feedback"
                                  >
                                    <div
                                      *ngIf="fi['itemUnidadeDTO'].errors['required']"
                                    >
                                      Selecione um Agrupamento
                                    </div>
                                  </div>
                                </div>
                              </div>
        
                              <div class="col-sm-2 col-12 div-line">
                                <div class="form-group">
                                  <label for="idItemQTD">QTD</label>
                                  <input
                                    class="form-control"
                                    id="idItemQTD"
                                    type="number"
                                    [ngClass]="{
                                      'is-invalid': submittedItem && fi['qtd'].errors
                                    }"
                                    (keydown.enter)="addMovimentoItem($event)"
                                    inputmode="numeric"
                                    formControlName="qtd"
                                  />
        
                                  <div
                                    *ngIf="submittedItem && fi['qtd'].errors"
                                    class="invalid-feedback"
                                  >
                                    <div *ngIf="fi['qtd'].errors['required']">
                                      Digite a QTD
                                    </div>
                                    <div *ngIf="fi['qtd'].errors['min']">
                                      Qtd deve ser maior que 0
                                    </div>
                                  </div>
                                </div>
                              </div>
        
                              <div class="col-sm-2 col-12 div-line">
                                <div class="form-group">
                                  <label for="idItemSaldo">Saldo Estoque</label>
                                  <input
                                    class="form-control"
                                    id="idItemSaldo"
                                    type="number"
                                    formControlName="saldo"
                                  />
                                </div>
                              </div>
        
                              <div class="col-sm-2 col-12 div-line">
                                <div class="form-group">
                                  <label for="idItemValor">Valor</label>
                                  <input
                                    class="form-control"
                                    id="idItemValor"
                                    type="number"
                                    [ngClass]="{
                                      'is-invalid': submittedItem && fi['valor'].errors
                                    }"
                                    (keydown.enter)="addMovimentoItem($event)"
                                    inputmode="numeric"
                                    formControlName="valor"
                                  />
        
                                  <div
                                    *ngIf="submittedItem && fi['valor'].errors"
                                    class="invalid-feedback"
                                  >
                                    <div *ngIf="fi['valor'].errors['required']">
                                      Digite o Valor
                                    </div>
                                    <div *ngIf="fi['valor'].errors['min']">
                                      Valor deve ser maior que 0
                                    </div>
                                  </div>
                                </div>
                              </div>
        
                              <div class="col-sm-2 col-12 div-line">
                                <div class="form-group">
                                  <label for="idItemMediaValorUnit"
                                    >Média Valor Unitário</label
                                  >
                                  <input
                                    class="form-control"
                                    id="idItemMediaValorUnit"
                                    type="text"
                                    [value]="getVlrMedio() | number : '1.2-6' : 'pt-BR'"
                                    disabled
                                  />
                                </div>
                              </div>
        
                              <div class="col-sm-12 col-12 div-line">
                                <div class="form-group">
                                  <label for="inlineCheckbox1">Configurações</label
                                  ><br />
                                  <div class="form-check form-check-inline">
                                    <input
                                      class="form-check-input"
                                      type="checkbox"
                                      id="inlineCheckbox1"
                                      [value]="true"
                                      formControlName="indGeraPreco"
                                    />
                                    <label
                                      class="form-check-label"
                                      for="inlineCheckbox1"
                                      >Gera Preço</label
                                    >
                                  </div>
                                  <div class="form-check form-check-inline">
                                    <input
                                      class="form-check-input"
                                      type="checkbox"
                                      id="inlineCheckbox2"
                                      [value]="true"
                                      formControlName="indGeraEstoque"
                                    />
                                    <label
                                      class="form-check-label"
                                      for="inlineCheckbox2"
                                      >Gera Estoque</label
                                    >
                                  </div>
                                </div>
                              </div>
                            </div>
        
                            <hr />
        
                            <div class="row">
                              <div class="col-sm-3 col-6 d-grid">
                                <button
                                  class="btn btn-block butao-acao btn-primary"
                                  (click)="addMovimentoItem($event)"
                                  ngbTooltip="Clique aqui para adicionar o item do movimento"
                                >
                                  <span
                                    class="fa fa-plus span-buttons-body span-acao"
                                  ></span>
                                  Adicionar Item
                                </button>
                              </div>
                              <div class="col-sm-3 col-6 d-grid">
                                <button
                                  class="btn btn-block btn-outline-dark butao-acao"
                                  (click)="onLimpaMovimentoItem()"
                                >
                                  <span
                                    class="fa fa-eraser span-buttons-body span-acao"
                                  ></span>
                                  Limpar Item
                                </button>
                              </div>
                            </div>
        
                            <hr />
        
                            <ngx-datatable
                              class="material"
                              [scrollbarH]="true"
                              appResizeWatcher
                              [rows]="movimento.movimentoItemDTOs"
                              [columnMode]="'force'"
                              [rowClass]="getRowClass"
                              [headerHeight]="35"
                              [footerHeight]="70"
                              rowHeight="auto"
                              [limit]="200"
                              [selected]="selectedMovItem"
                              [selectionType]="selectionTypeSingle"
                              [sorts]="[{ prop: 'ordemInclusaoTimestamp', dir: 'asc' }]"
                              (select)="onSelectMovimentoItem($event)"
                            >
                              <ngx-datatable-column name="RM" [width]="40">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                  <button
                                    type="button"
                                    class="btn btn-danger botao-acao-item"
                                    style="padding: 1px 7px 1px 7px"
                                    [disabled]="isDisableDeleteMovimentoItem()"
                                    (click)="onDeletaMovimentoItem(row)"
                                  >
                                    <span
                                      class="fa fa-trash span-btn-excluir"
                                      style="padding: 0; margin: 0"
                                    ></span>
                                  </button>
                                </ng-template>
                              </ngx-datatable-column>
        
                              <ngx-datatable-column
                                name="ITEM ID"
                                prop="itemDTO.id"
                                [width]="70"
                              >
                              </ngx-datatable-column>
        
                              <ngx-datatable-column
                                name="ITEM"
                                prop="itemDTO.nome"
                                [width]="400"
                              >
                              </ngx-datatable-column>
                              <ngx-datatable-column
                                name="UNIDADE"
                                prop="itemUnidadeDTO.nome"
                                [width]="200"
                              >
                              </ngx-datatable-column>
                              <ngx-datatable-column name="QTD" prop="qtd" [width]="120">
                                <ng-template
                                  let-value="value"
                                  ngx-datatable-cell-template
                                >
                                  {{ value | number : "1.2-2" : "pt-BR" }}
                                </ng-template>
                              </ngx-datatable-column>
        
                              <ngx-datatable-column
                                name="QTD UN"
                                prop="qtdConvertido"
                                [width]="120"
                              >
                                <ng-template
                                  let-value="value"
                                  ngx-datatable-cell-template
                                >
                                  {{ value | number : "1.2-2" : "pt-BR" }}
                                </ng-template>
                              </ngx-datatable-column>
        
                              <ngx-datatable-column
                                name="VALOR"
                                prop="valor"
                                [width]="120"
                              >
                                <ng-template
                                  let-value="value"
                                  ngx-datatable-cell-template
                                >
                                  {{ value | number : "1.2-2" : "pt-BR" }}
                                </ng-template>
                              </ngx-datatable-column>
                              <ngx-datatable-column
                                name="VALOR UN"
                                prop="valorUnitario"
                                [width]="120"
                              >
                                <ng-template
                                  let-value="value"
                                  ngx-datatable-cell-template
                                >
                                  {{ value | number : "1.2-2" : "pt-BR" }}
                                </ng-template>
                              </ngx-datatable-column>
                              <ngx-datatable-column
                                name="GERA ESTOQUE"
                                prop="indGeraEstoque"
                                [width]="120"
                              >
                                <ng-template
                                  let-value="value"
                                  ngx-datatable-cell-template
                                >
                                  {{ value === true ? "Sim" : "Não" }}
                                </ng-template>
                              </ngx-datatable-column>
        
                              <ngx-datatable-column
                                name="GERA PREÇO"
                                prop="indGeraPreco"
                                [width]="1020"
                              >
                                <ng-template
                                  let-value="value"
                                  ngx-datatable-cell-template
                                >
                                  {{ value === true ? "Sim" : "Não" }}
                                </ng-template>
                              </ngx-datatable-column>
                            </ngx-datatable>
                          </ng-template>
                          
                        </div>
                    </div>
                </div>
            </div>



            </form>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="statusForm === 3">
      <div class="card bg-light mb-3">
        <div class="card-header">Ações</div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-3 col-xl-3 col-6 d-grid">
              <button
                type="button"
                class="btn btn-block btn-primary butao-acao"
                (click)="voltar()"
              >
                <span class="fa fa-arrow-left span-acao"></span> Voltar
              </button>
            </div>

            <div class="col-lg-3 col-xl-3 col-6 d-grid">
              <button
                type="button"
                class="btn btn-block btn-warning butao-acao"
                [disabled]="selected.length === 0"
                (click)="editando()"
              >
                <span class="fa fa-edit span-acao"></span> Editar
              </button>
            </div>

            <!-- <div class="col-lg-3 col-xl-3 col-12 d-grid">
                            <button type="button" class="btn btn-block btn-warning butao-acao" (click)="geraCSV()">
                                <span class="span-acao fa"
                                    [ngClass]="botaoGeraCSV != 'Gerar CSV' ? 'fa-refresh fa-spin fa-fw' : ''"></span>
                                {{botaoGeraCSV}}
                            </button>
                        </div> -->
          </div>
        </div>
      </div>

      <ngx-datatable
        class="material striped"
        [scrollbarH]="true"
        [rows]="pageMovimento.content"
        appResizeWatcher
        [columnMode]="ColumnMode.standard"
        [rowClass]="getRowClass"
        [headerHeight]="35"
        [footerHeight]="70"
        rowHeight="auto"
        [selected]="selected"
        [selectionType]="selectionTypeSingle"
        (activate)="onActivate($event)"
        [externalPaging]="true"
        [count]="pageMovimento.totalElements"
        [offset]="pageMovimento.pageable.pageNumber"
        [limit]="pageMovimento.size"
        (page)="setPage($event)"
      >
        <ngx-datatable-column
          name="ID MOV"
          prop="id"
          [width]="110"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="ID PRE VENDA"
          prop="preVendaId"
          [width]="110"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="ID ROMANEIO"
          prop="rotaId"
          [width]="110"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="TIPO"
          prop="movimentoTipoNome"
          [width]="450"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="ALMOXARIFADO"
          prop="estoqueAlmoxarifadoNome"
          [width]="350"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="ORIGEM"
          prop="movimentoOrigemNome"
          [width]="300"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="DATA INCLUSÃO"
          prop="dtaInclusao"
          [width]="200"
        >
          <ng-template let-value="value" ngx-datatable-cell-template>
            {{ value | amDateFormat : "DD/MM/YYYY HH:mm:ss" }}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column
          name="USUÁRIO INCLUSÃO"
          prop="usuarioInclusao"
          [width]="150"
        ></ngx-datatable-column>
        <ngx-datatable-column name="STATUS" prop="indAtivo" [width]="90">
          <ng-template let-value="value" ngx-datatable-cell-template>
            {{ value === true ? "Ativo" : "Desativado" }}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="AUDITORIA" prop="indAuditoria" [width]="90">
          <ng-template let-value="value" ngx-datatable-cell-template>
            {{ value === true ? "Sim" : "Não" }}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column
          name="CLIENTE"
          prop="clienteNome"
          [width]="400"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="FORNECEDOR"
          prop="fornecedorNome"
          [width]="500"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="VEICULO"
          prop="veiculoNome"
          [width]="250"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="MOTORISTA"
          prop="motoristaFuncionarioNome"
          [width]="300"
        ></ngx-datatable-column>
        <ngx-datatable-column
          name="CONFERENTE"
          prop="conferenteFuncionarioNome"
          [width]="300"
        ></ngx-datatable-column>
      </ngx-datatable>
    </div>
  </div>
</div>
